@model IEnumerable<Niveau.Areas.Admin.Models.Products.Product>

@{
    ViewData["Title"] = "Index";
}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<h2>Product</h2>
<a href="@Url.Action("Create")" class="btn btn-primary m-2"><i class="fa-solid fa-plus"></i> Create New</a>
<a asp-controller="Categories" asp-action="Index" class="btn btn-primary m-2"><i class="fa-solid fa-list"></i> Category</a>

<div class="card">

    <div id="productListContainer" class="card-body">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <div id="product">
                    @foreach (var product in Model.OrderByDescending(p => p.IsActive))
                    {
                    <tr class="product">
                        <td>@product.Name</td>
                        <td>@product.Price</td>
                        <td>@product.Description</td>
                        <td>@product.Category?.Name</td>
                        <td  data-status="@product.IsActive" style="color: @(product.IsActive ? "green" : "red");">
                                @((product.IsActive ? "Active" : "Disabled"))
                        </td>
                        <td class="align-middle">

                            <a class="btn btn-success" asp-action="Details" asp-route-id="@product.Id"><i class="fa-solid fa-eye"></i> View</a> |

                            <a class="btn btn-primary" asp-action="Edit" asp-route-id="@product.Id"><i class="fa-solid fa-pen-to-square"></i> Edit</a> |

                            <a id="toggleButton" class="btn btn-danger" data-product-id="@product.Id"><i class="fa-solid fa-trash"></i> Disable</a> |

                            <a id="deleteButton" style="display:none;" onclick="showSweetAlert()"
                               class="btn btn-danger" asp-action="Delete" asp-route-id="@product.Id"><i class="fa-solid fa-trash"></i> Delete</a>

                        </td>
                    </tr>
                    }
                </div>
            </tbody>
        </table>


    </div>

</div>
<style>
    .active {
        background-color: green; /* Green background for the active state */
        color: white; /* White text color for better readability */
    }
</style>

@* <script>
    document.getElementById('status').addEventListener('click', function () {
        var deleteButton = document.getElementById('deleteButton');
        var status = document.getElementById('status').textContent;

        if (status === 'Active') {


            if (deleteButton.style.display === 'none') {
                deleteButton.style.display = 'inline-block'; // Show delete button
                this.textContent = 'Activate';
                this.className = 'btn active';// Change toggle button text to 'Activate'
            } else {
                deleteButton.style.display = 'none'; // Hide delete button
                this.textContent = 'Disable';
                this.className = 'btn btn-danger'// Change back toggle button text to 'Disable'
            }
        }
        else { 
            deleteButton.style.display = 'none'; // Hide delete button
            this.textContent = 'Disable';
            this.className = 'btn btn-danger'
        }

    });
</script> *@

<script>
    function showSweetAlert() {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                // Logic to delete the item
                Swal.fire(
                    'Deleted!',
                    'Your file has been deleted.',
                    'success'
                )
            }
        });
    }
</script>
@* var status = document.getElementById('status')
        if (status === 'Active') *@
<script>
    $(document).ready(function () {
        $('.product').each(function () {
            var status = $(this).data('status');  // Get the status from data attribute
            var deleteButton = $(this).find('#deleteButton');
            var toggleButton = $(this).find('#toggleButton');

            if (status === true) {  // Assume true means active and false means disabled
                deleteButton.hide(); // Hide the delete button if product is active
                toggleButton.text('Disable');
                toggleButton.removeClass('active').addClass('btn-danger')// Set button to disable mode
            }
            if (status === false) {
                deleteButton.show(); // Show the delete button if product is disabled
                toggleButton.text('Activate');
                toggleButton.removeClass('btn-danger').addClass('active')// Set button to activate mode
            }
        });

        $('#toggleButton').click(function () {
            var productId = $(this).data('product-id');
            var confirmAction = confirm('Are you sure you want to disable this product?');

            if (confirmAction && $(this).text == 'Disable') {
                $.ajax({
                    url: '@Url.Action("Disable", "Products", new { area = "Admin" })',
                    type: 'POST',
                    data: { id: productId },
                    success: function (response) {
                        $('#productListContainer').load(location.href + ' #productListContainer'); // Reload part of the page
                    },
                    error: function (xhr, status, error) {
                        console.error('Error disabling product:', error);
                    }
                });
            }
            else { 
            }
        });
    });
</script>
